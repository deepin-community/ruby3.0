From c5cfa60b151dce72522d14ebdf7370f60d9b2d47 Mon Sep 17 00:00:00 2001
From: Hiroshi SHIBATA <hsbt@ruby-lang.org>
Date: Wed, 21 Jun 2023 13:20:54 +0900
Subject: [PATCH] Merge URI-0.12.2

---
 lib/uri/rfc2396_parser.rb |  4 ++--
 lib/uri/rfc3986_parser.rb |  2 +-
 lib/uri/version.rb        |  2 +-
 test/uri/test_parser.rb   | 22 ++++++++++++++++++++++
 4 files changed, 26 insertions(+), 4 deletions(-)

Index: ruby3.0-3.0.4/lib/uri/rfc2396_parser.rb
===================================================================
--- ruby3.0-3.0.4.orig/lib/uri/rfc2396_parser.rb
+++ ruby3.0-3.0.4/lib/uri/rfc2396_parser.rb
@@ -491,8 +491,8 @@ module URI
       ret = {}
 
       # for URI::split
-      ret[:ABS_URI] = Regexp.new('\A\s*' + pattern[:X_ABS_URI] + '\s*\z', Regexp::EXTENDED)
-      ret[:REL_URI] = Regexp.new('\A\s*' + pattern[:X_REL_URI] + '\s*\z', Regexp::EXTENDED)
+      ret[:ABS_URI] = Regexp.new('\A\s*+' + pattern[:X_ABS_URI] + '\s*\z', Regexp::EXTENDED)
+      ret[:REL_URI] = Regexp.new('\A\s*+' + pattern[:X_REL_URI] + '\s*\z', Regexp::EXTENDED)
 
       # for URI::extract
       ret[:URI_REF]     = Regexp.new(pattern[:URI_REF])
Index: ruby3.0-3.0.4/lib/uri/rfc3986_parser.rb
===================================================================
--- ruby3.0-3.0.4.orig/lib/uri/rfc3986_parser.rb
+++ ruby3.0-3.0.4/lib/uri/rfc3986_parser.rb
@@ -95,7 +95,7 @@ module URI
         QUERY: /\A(?:%\h\h|[!$&-.0-;=@-Z_a-z~\/?])*\z/,
         FRAGMENT: /\A(?:%\h\h|[!$&-.0-;=@-Z_a-z~\/?])*\z/,
         OPAQUE: /\A(?:[^\/].*)?\z/,
-        PORT: /\A[\x09\x0a\x0c\x0d ]*\d*[\x09\x0a\x0c\x0d ]*\z/,
+        PORT: /\A[\x09\x0a\x0c\x0d ]*+\d*[\x09\x0a\x0c\x0d ]*\z/,
       }
     end
 
